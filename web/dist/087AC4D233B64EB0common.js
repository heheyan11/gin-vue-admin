/*! 
 Build based on gin-vue-admin 
 Time : 1699839817000 */
import{v as e,a as t,m as a,o as s,c as o,d as i,w as l,g as n,G as r,k as d,E as p}from"./087AC4D233B64EB0index.js";import{E as c}from"./087AC4D233B64EB0upload2.js";import"./087AC4D233B64EB0progress.js";/* empty css                      */import{_ as m}from"./087AC4D233B64EB0_plugin-vue_export-helper.js";const u=t=>e({url:"/fileUploadAndDownload/getFileList",method:"post",data:t}),h=t=>e({url:"/fileUploadAndDownload/deleteFile",method:"post",data:t}),g=t=>e({url:"/fileUploadAndDownload/editFileName",method:"post",data:t});class f{constructor(e,t,a=1920){this.file=e,this.fileSize=t,this.maxWH=a}compress(){const e=this.file.type,t=this.file.size/1024;return new Promise((a=>{const s=new FileReader;s.readAsDataURL(this.file),s.onload=()=>{const o=document.createElement("canvas"),i=document.createElement("img");i.src=s.result,i.onload=()=>{const s=o.getContext("2d"),l=this.dWH(i.width,i.height,this.maxWH);o.width=l.width,o.height=l.height,s.clearRect(0,0,o.width,o.height),s.drawImage(i,0,0,o.width,o.height);const n=o.toDataURL(e,.9),r=this.fileSizeKB(n);r>this.fileSize&&console.log("图片尺寸太大!"+t+" >> "+r);const d=this.dataURLtoBlob(n,e),p=new File([d],this.file.name);a(p)}}}))}dWH(e,t,a){const s={width:e,height:t};return Math.max(e,t)>a?e>t?(s.width=a,s.height=Math.round(t*(a/e)),s):(s.height=a,s.width=Math.round(e*(a/t)),s):s}fileSizeKB(e){let t=0;return t=Math.round(3*e.split(",")[1].length/4/1024),t}dataURLtoBlob(e,t){const a=atob(e.split(",")[1]);let s=e.split(",")[0].split(":")[1].split(";")[0];const o=new ArrayBuffer(a.length),i=new Uint8Array(o);for(let l=0;l<a.length;l++)i[l]=a.charCodeAt(l);return t&&(s=t),new Blob([o],{type:s,lastModifiedDate:new Date})}}const w=e=>e&&"http"!==e.slice(0,4)?"/api/"+e:e,v=e=>e.endsWith(".mp4")||e.endsWith(".mov")||e.endsWith(".webm")||e.endsWith(".ogg"),B=m(Object.assign({name:"UploadImage"},{__name:"image",props:{imageUrl:{type:String,default:""},fileSize:{type:Number,default:2048},maxWH:{type:Number,default:1920}},emits:["on-success"],setup(e,{emit:m}){const u=m,h=e,g=t("/api"),w=a(),v=e=>{const t="image/jpeg"===e.type,a="image/png"===e.type;if(!t&&!a)return d.error("上传头像图片只能是 jpg或png 格式!"),!1;const s=e.size/1024<h.fileSize;if(!s){return new f(e,h.fileSize,h.maxWH).compress()}return s},B=e=>{const{data:t}=e;t.file&&u("on-success",t.file.url)};return(e,t)=>{const a=p,d=c;return s(),o("div",null,[i(d,{action:"".concat(g.value,"/fileUploadAndDownload/upload"),headers:{"x-token":r(w).token},"show-file-list":!1,"on-success":B,"before-upload":v,multiple:!1},{default:l((()=>[i(a,{type:"primary"},{default:l((()=>[n("压缩上传")])),_:1})])),_:1},8,["action","headers"])])}}}),[["__scopeId","data-v-25e77e3f"]]),b=Object.assign({name:"UploadCommon"},{__name:"common",emits:["on-success"],setup(e,{emit:m}){const u=m,h=t("/api"),g=a(),f=t(!1),w=e=>{f.value=!0;const t=e.size/1024/1024<.5,a=e.size/1024/1024<5,s="video/mp4"==(o=e.type)||"video/webm"==o||"video/ogg"==o;var o;const i=(e=>"image/jpeg"==e||"image/png"==e||"image/webp"==e||"image/svg+xml"==e)(e.type);let l=!0;return s||i||(d.error("上传图片只能是 jpg,png,svg,webp 格式, 上传视频只能是 mp4,webm 格式!"),f.value=!1,l=!1),!a&&s&&(d.error("上传视频大小不能超过 5MB"),f.value=!1,l=!1),!t&&i&&(d.error("未压缩的上传图片大小不能超过 500KB，请使用压缩上传"),f.value=!1,l=!1),console.log("upload file check result: ",l),l},v=e=>{const{data:t}=e;t.file&&u("on-success",t.file.url)},B=()=>{d({type:"error",message:"上传失败"}),f.value=!1};return(e,t)=>{const a=p,d=c;return s(),o("div",null,[i(d,{action:"".concat(h.value,"/fileUploadAndDownload/upload"),"before-upload":w,headers:{"x-token":r(g).token},"on-error":B,"on-success":v,"show-file-list":!1,class:"upload-btn"},{default:l((()=>[i(a,{type:"primary"},{default:l((()=>[n("普通上传")])),_:1})])),_:1},8,["action","headers"])])}}});export{B as U,b as _,w as a,h as d,g as e,u as g,v as i};
