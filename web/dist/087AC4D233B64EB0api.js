/*! 
 Build based on gin-vue-admin 
 Time : 1698979068000 */
import{a as e,o as a,c as l,b as t,d as o,w as i,M as u,N as s,h as r,g as p,G as d,cO as n,t as c,k as m,a4 as v,l as f,E as g,J as B,p as h,i as b}from"./087AC4D233B64EB0index.js";import{E as C}from"./087AC4D233B64EB0dialog.js";import"./087AC4D233B64EB0overlay.js";import{E as y}from"./087AC4D233B64EB0pagination.js";/* empty css                     */import"./087AC4D233B64EB0tag.js";import{E as A,a as _}from"./087AC4D233B64EB0select.js";import"./087AC4D233B64EB0scrollbar.js";/* empty css                      */import{E,a as D}from"./087AC4D233B64EB0table-column.js";import"./087AC4D233B64EB0checkbox.js";/* empty css                       */import{E as j}from"./087AC4D233B64EB0popover.js";/* empty css                     */import{a as w,E as V}from"./087AC4D233B64EB0form-item.js";/* empty css                      */import{g as k,d as x,f as U,a as G,u as I,c as z,b as P}from"./087AC4D233B64EB0api2.js";import{t as T}from"./087AC4D233B64EB0stringFun.js";import{_ as S}from"./087AC4D233B64EB0warningBar.js";import{t as q}from"./087AC4D233B64EB0doc.js";import{_ as F}from"./087AC4D233B64EB0_plugin-vue_export-helper.js";import"./087AC4D233B64EB0isEqual.js";import"./087AC4D233B64EB0_Uint8Array.js";import"./087AC4D233B64EB0hasIn.js";import"./087AC4D233B64EB0index21.js";import"./087AC4D233B64EB0index22.js";import"./087AC4D233B64EB0strings.js";import"./087AC4D233B64EB0debounce.js";import"./087AC4D233B64EB0_initCloneObject.js";import"./087AC4D233B64EB0dropdown.js";import"./087AC4D233B64EB0castArray.js";import"./087AC4D233B64EB0_baseClone.js";const O=e=>(h("data-v-5fcf167e"),e=e(),b(),e),J={class:"gva-search-box"},K={class:"gva-table-box"},L={class:"gva-btn-list"},M=O((()=>t("p",null,"确定要删除吗？",-1))),N={style:{"text-align":"right","margin-top":"8px"}},R=O((()=>t("p",null,"确定要刷新Casbin缓存吗？",-1))),H={style:{"text-align":"right","margin-top":"8px"}},Q={class:"gva-pagination"},W={class:"dialog-footer"},X=F(Object.assign({name:"Api"},{__name:"api",setup(h){const b=e=>{const a=X.value.filter((a=>a.value===e))[0];return a&&"".concat(a.label)},F=e([]),O=e({path:"",apiGroup:"",method:"",description:""}),X=e([{value:"POST",label:"创建",type:"success"},{value:"GET",label:"查看",type:""},{value:"PUT",label:"更新",type:"warning"},{value:"DELETE",label:"删除",type:"danger"}]),Y=e(""),Z=e({path:[{required:!0,message:"请输入api路径",trigger:"blur"}],apiGroup:[{required:!0,message:"请输入组名称",trigger:"blur"}],method:[{required:!0,message:"请选择请求方式",trigger:"blur"}],description:[{required:!0,message:"请输入api介绍",trigger:"blur"}]}),$=e(1),ee=e(0),ae=e(10),le=e([]),te=e({}),oe=()=>{te.value={}},ie=()=>{$.value=1,ae.value=10,pe()},ue=e=>{ae.value=e,pe()},se=e=>{$.value=e,pe()},re=({prop:e,order:a})=>{e&&("ID"===e&&(e="id"),te.value.orderKey=T(e),te.value.desc="descending"===a),pe()},pe=async()=>{const e=await k({page:$.value,pageSize:ae.value,...te.value});0===e.code&&(le.value=e.data.list,ee.value=e.data.total,$.value=e.data.page,ae.value=e.data.pageSize)};pe();const de=e=>{F.value=e},ne=e(!1),ce=async()=>{const e=F.value.map((e=>e.ID)),a=await x({ids:e});0===a.code&&(m({type:"success",message:a.msg}),le.value.length===e.length&&$.value>1&&$.value--,ne.value=!1,pe())},me=e(!1),ve=async()=>{const e=await U();0===e.code&&m({type:"success",message:e.msg}),me.value=!1},fe=e(null),ge=e("新增Api"),Be=e(!1),he=e=>{switch(e){case"addApi":ge.value="新增Api";break;case"edit":ge.value="编辑Api"}Y.value=e,Be.value=!0},be=()=>{fe.value.resetFields(),O.value={path:"",apiGroup:"",method:"",description:""},Be.value=!1},Ce=async()=>{fe.value.validate((async e=>{if(e)switch(Y.value){case"addApi":0===(await z(O.value)).code&&m({type:"success",message:"添加成功",showClose:!0}),pe(),be();break;case"edit":0===(await I(O.value)).code&&m({type:"success",message:"编辑成功",showClose:!0}),pe(),be();break;default:m({type:"error",message:"未知操作",showClose:!0})}}))};return(e,h)=>{const k=f,x=w,U=A,I=_,z=g,T=V,Y=B,ye=j,Ae=E,_e=D,Ee=y,De=C;return a(),l("div",null,[t("div",J,[o(T,{ref:"searchForm",inline:!0,model:te.value},{default:i((()=>[o(x,{label:"路径"},{default:i((()=>[o(k,{modelValue:te.value.path,"onUpdate:modelValue":h[0]||(h[0]=e=>te.value.path=e),placeholder:"路径"},null,8,["modelValue"])])),_:1}),o(x,{label:"描述"},{default:i((()=>[o(k,{modelValue:te.value.description,"onUpdate:modelValue":h[1]||(h[1]=e=>te.value.description=e),placeholder:"描述"},null,8,["modelValue"])])),_:1}),o(x,{label:"API组"},{default:i((()=>[o(k,{modelValue:te.value.apiGroup,"onUpdate:modelValue":h[2]||(h[2]=e=>te.value.apiGroup=e),placeholder:"api组"},null,8,["modelValue"])])),_:1}),o(x,{label:"请求"},{default:i((()=>[o(I,{modelValue:te.value.method,"onUpdate:modelValue":h[3]||(h[3]=e=>te.value.method=e),clearable:"",placeholder:"请选择"},{default:i((()=>[(a(!0),l(u,null,s(X.value,(e=>(a(),r(U,{key:e.value,label:"".concat(e.label,"(").concat(e.value,")"),value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),o(x,null,{default:i((()=>[o(z,{type:"primary",icon:"search",onClick:ie},{default:i((()=>[p("查询")])),_:1}),o(z,{icon:"refresh",onClick:oe},{default:i((()=>[p("重置")])),_:1})])),_:1})])),_:1},8,["model"])]),t("div",K,[t("div",L,[o(z,{type:"primary",icon:"plus",onClick:h[4]||(h[4]=e=>he("addApi"))},{default:i((()=>[p("新增")])),_:1}),o(Y,{class:"cursor-pointer",onClick:h[5]||(h[5]=e=>d(q)("https://www.bilibili.com/video/BV1kv4y1g7nT?p=7&vd_source=f2640257c21e3b547a790461ed94875e"))},{default:i((()=>[o(d(n))])),_:1}),o(ye,{modelValue:ne.value,"onUpdate:modelValue":h[8]||(h[8]=e=>ne.value=e),placement:"top",width:"160"},{reference:i((()=>[o(z,{icon:"delete",disabled:!F.value.length,onClick:h[7]||(h[7]=e=>ne.value=!0)},{default:i((()=>[p("删除")])),_:1},8,["disabled"])])),default:i((()=>[M,t("div",N,[o(z,{type:"primary",link:"",onClick:h[6]||(h[6]=e=>ne.value=!1)},{default:i((()=>[p("取消")])),_:1}),o(z,{type:"primary",onClick:ce},{default:i((()=>[p("确定")])),_:1})])])),_:1},8,["modelValue"]),o(ye,{modelValue:me.value,"onUpdate:modelValue":h[11]||(h[11]=e=>me.value=e),placement:"top",width:"160"},{reference:i((()=>[o(z,{icon:"Refresh",onClick:h[10]||(h[10]=e=>me.value=!0)},{default:i((()=>[p("刷新缓存")])),_:1})])),default:i((()=>[R,t("div",H,[o(z,{type:"primary",link:"",onClick:h[9]||(h[9]=e=>me.value=!1)},{default:i((()=>[p("取消")])),_:1}),o(z,{type:"primary",onClick:ve},{default:i((()=>[p("确定")])),_:1})])])),_:1},8,["modelValue"])]),o(_e,{data:le.value,onSortChange:re,onSelectionChange:de},{default:i((()=>[o(Ae,{type:"selection",width:"55"}),o(Ae,{align:"left",label:"id","min-width":"60",prop:"ID",sortable:"custom"}),o(Ae,{align:"left",label:"API路径","min-width":"150",prop:"path",sortable:"custom"}),o(Ae,{align:"left",label:"API分组","min-width":"150",prop:"apiGroup",sortable:"custom"}),o(Ae,{align:"left",label:"API简介","min-width":"150",prop:"description",sortable:"custom"}),o(Ae,{align:"left",label:"请求","min-width":"150",prop:"method",sortable:"custom"},{default:i((e=>[t("div",null,c(e.row.method)+" / "+c(b(e.row.method)),1)])),_:1}),o(Ae,{align:"left",fixed:"right",label:"操作",width:"200"},{default:i((e=>[o(z,{icon:"edit",type:"primary",link:"",onClick:a=>(async e=>{const a=await G({id:e.ID});O.value=a.data.api,he("edit")})(e.row)},{default:i((()=>[p("编辑")])),_:2},1032,["onClick"]),o(z,{icon:"delete",type:"primary",link:"",onClick:a=>(async e=>{v.confirm("此操作将永久删除所有角色下该api, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{0===(await P(e)).code&&(m({type:"success",message:"删除成功!"}),1===le.value.length&&$.value>1&&$.value--,pe())}))})(e.row)},{default:i((()=>[p("删除")])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"]),t("div",Q,[o(Ee,{"current-page":$.value,"page-size":ae.value,"page-sizes":[10,30,50,100],total:ee.value,layout:"total, sizes, prev, pager, next, jumper",onCurrentChange:se,onSizeChange:ue},null,8,["current-page","page-size","total"])])]),o(De,{modelValue:Be.value,"onUpdate:modelValue":h[16]||(h[16]=e=>Be.value=e),"before-close":be,title:ge.value},{footer:i((()=>[t("div",W,[o(z,{onClick:be},{default:i((()=>[p("取 消")])),_:1}),o(z,{type:"primary",onClick:Ce},{default:i((()=>[p("确 定")])),_:1})])])),default:i((()=>[o(S,{title:"新增API，需要在角色管理内配置权限才可使用"}),o(T,{ref_key:"apiForm",ref:fe,model:O.value,rules:Z.value,"label-width":"80px"},{default:i((()=>[o(x,{label:"路径",prop:"path"},{default:i((()=>[o(k,{modelValue:O.value.path,"onUpdate:modelValue":h[12]||(h[12]=e=>O.value.path=e),autocomplete:"off"},null,8,["modelValue"])])),_:1}),o(x,{label:"请求",prop:"method"},{default:i((()=>[o(I,{modelValue:O.value.method,"onUpdate:modelValue":h[13]||(h[13]=e=>O.value.method=e),placeholder:"请选择",style:{width:"100%"}},{default:i((()=>[(a(!0),l(u,null,s(X.value,(e=>(a(),r(U,{key:e.value,label:"".concat(e.label,"(").concat(e.value,")"),value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),o(x,{label:"api分组",prop:"apiGroup"},{default:i((()=>[o(k,{modelValue:O.value.apiGroup,"onUpdate:modelValue":h[14]||(h[14]=e=>O.value.apiGroup=e),autocomplete:"off"},null,8,["modelValue"])])),_:1}),o(x,{label:"api简介",prop:"description"},{default:i((()=>[o(k,{modelValue:O.value.description,"onUpdate:modelValue":h[15]||(h[15]=e=>O.value.description=e),autocomplete:"off"},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["modelValue","title"])])}}}),[["__scopeId","data-v-5fcf167e"]]);export{X as default};
